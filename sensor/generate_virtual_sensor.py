from math import sin, cos, sqrt, atan2, pi
import requests
import json
density = 10  # 10m between each device
segments = [(121.43675, 25.06873),
            (121.43621, 25.06866),
            (121.43559, 25.06859),
            (121.43528, 25.06856),
            (121.43523, 25.06856),
            (121.43517, 25.06855),
            (121.43495, 25.06853),
            (121.43414, 25.06848),
            (121.43312, 25.06843),
            (121.43306, 25.06842),
            (121.43305, 25.06842),
            (121.43221, 25.06839),
            (121.43157, 25.06836),
            (121.43132, 25.06835),
            (121.43095, 25.06833),
            (121.42996, 25.06829),
            (121.42971, 25.06828),
            (121.42871, 25.06822),
            (121.42809, 25.06816),
            (121.42793, 25.06815),
            (121.42791, 25.06814),
            (121.42726, 25.06804),
            (121.42686, 25.06796),
            (121.42654, 25.06788),
            (121.42616, 25.06777),
            (121.42578, 25.06765),
            (121.42546, 25.06753),
            (121.42509, 25.06739),
            (121.42546, 25.06753),
            (121.42509, 25.06739),
            (121.42474, 25.06724),
            (121.42442, 25.06707),
            (121.42404, 25.06687),
            (121.42371, 25.06668),
            (121.42306, 25.06630),
            (121.42267, 25.06606),
            (121.42227, 25.06582),
            (121.42190, 25.06558),
            (121.42142, 25.06528),
            (121.42082, 25.06491),
            (121.42037, 25.06462),
            (121.42030, 25.06458),
            (121.42022, 25.06454),
            (121.41982, 25.06431),
            (121.41940, 25.06406),
            (121.41857, 25.06357),
            (121.41805, 25.06326),
            (121.41750, 25.06291),
            (121.41702, 25.06258),
            (121.41695, 25.06253),
            (121.41534, 25.06156),
            (121.41269, 25.05988),
            (121.41223, 25.05961),
            (121.41167, 25.05924),
            (121.41259, 25.06017),
            (121.41126, 25.05925),
            (121.41068, 25.05888),
            (121.41026, 25.05858),
            (121.40968, 25.05814),
            (121.40965, 25.05812),
            (121.40923, 25.05778),
            (121.40887, 25.05748),
            (121.40860, 25.05731),
            (121.40810, 25.05700),
            (121.40806, 25.05697),
            (121.40778, 25.05681),
            (121.40749, 25.05664),
            (121.40712, 25.05645),
            (121.40676, 25.05627),
            (121.40643, 25.05612),
            (121.40615, 25.05600),
            (121.40595, 25.05592),
            (121.40564, 25.05582),
            (121.40555, 25.05579),
            (121.40539, 25.05574),
            (121.40534, 25.05573),
            (121.40527, 25.05571),
            (121.40501, 25.05565),
            (121.40495, 25.05564),
            (121.40463, 25.05557),
            (121.40445, 25.05555),
            (121.40440, 25.05554),
            (121.40434, 25.05553),
            (121.40431, 25.05553),
            (121.40388, 25.05549),
            (121.40360, 25.05548),
            (121.40337, 25.05547),
            (121.40305, 25.05548),
            (121.40279, 25.05550),
            (121.40248, 25.05553),
            (121.40218, 25.05557),
            (121.40214, 25.05558),
            (121.40170, 25.05567),
            (121.40124, 25.05579),
            (121.40091, 25.05590),
            (121.40059, 25.05602),
            (121.40031, 25.05614),
            (121.40005, 25.05627),
            (121.39986, 25.05637),
            (121.39964, 25.05651),
            (121.39948, 25.05660),
            (121.39935, 25.05669),
            (121.39922, 25.05678),
            (121.39901, 25.05693),
            (121.39884, 25.05706),
            (121.39864, 25.05723),
            (121.39844, 25.05742),
            (121.39819, 25.05767),
            (121.39793, 25.05795),
            (121.39777, 25.05812),
            (121.39755, 25.05839),
            (121.39743, 25.05853),
            (121.39732, 25.05868),
            (121.39699, 25.05910),
            (121.39655, 25.05968),
            (121.39618, 25.06016),
            (121.39599, 25.06039),
            (121.39571, 25.06072),
            (121.39560, 25.06085),
            (121.39532, 25.06118),
            (121.39516, 25.06135),
            (121.39501, 25.06151),
            (121.39484, 25.06170),
            (121.39454, 25.06201),
            (121.39425, 25.06231),
            (121.39386, 25.06268),
            (121.39349, 25.06301),
            (121.39314, 25.06330),
            (121.39285, 25.06352),
            (121.39254, 25.06374),
            (121.39222, 25.06395),
            (121.39190, 25.06413),
            (121.39157, 25.06430),
            (121.39119, 25.06447),
            (121.39078, 25.06463),
            (121.39037, 25.06475),
            (121.39008, 25.06482),
            (121.38979, 25.06489),
            (121.38943, 25.06496),
            (121.38908, 25.06501),
            (121.38872, 25.06506),
            (121.38842, 25.06508),
            (121.38801, 25.06511),
            (121.38760, 25.06512),
            (121.38724, 25.06511),
            (121.38695, 25.06510),
            (121.38684, 25.06510),
            (121.38660, 25.06508),
            (121.38649, 25.06507),
            (121.38629, 25.06505),
            (121.38607, 25.06502),
            (121.38569, 25.06497),
            (121.38527, 25.06490),
            (121.38482, 25.06483),
            (121.38447, 25.06477),
            (121.38403, 25.06470),
            (121.38371, 25.06466),
            (121.38342, 25.06463),
            (121.38322, 25.06461),
            (121.38309, 25.06461),
            (121.38306, 25.06460),
            (121.38297, 25.06460),
            (121.38280, 25.06460),
            (121.38268, 25.06460),
            (121.38247, 25.06461),
            (121.38221, 25.06464),
            (121.38194, 25.06468),
            (121.38167, 25.06473),
            (121.38139, 25.06480),
            (121.38116, 25.06486),
            (121.38088, 25.06494),
            (121.38064, 25.06501),
            (121.38033, 25.06513),
            (121.38012, 25.06521),
            (121.37977, 25.06533),
            (121.37929, 25.06551),
            (121.37881, 25.06567),
            (121.37859, 25.06575),
            (121.37842, 25.06580),
            (121.37811, 25.06588),
            (121.37784, 25.06594),
            (121.37757, 25.06598),
            (121.37750, 25.06600),
            (121.37741, 25.06601),
            (121.37725, 25.06603),
            (121.37712, 25.06605),
            (121.37697, 25.06607),
            (121.37691, 25.06608),
            (121.37683, 25.06609),
            (121.37681, 25.06609),
            (121.37645, 25.06612),
            (121.37627, 25.06613),
            (121.37608, 25.06613),
            (121.37596, 25.06613),
            (121.37582, 25.06612),
            (121.37535, 25.06609),
            (121.37513, 25.06608),
            (121.37484, 25.06605),
            (121.37440, 25.06600),
            (121.37399, 25.06594),
            (121.37366, 25.06591),
            (121.37357, 25.06590),
            (121.37325, 25.06586),
            (121.37278, 25.06580),
            (121.37255, 25.06578),
            (121.37225, 25.06573),
            (121.37193, 25.06569),
            (121.37144, 25.06563),
            (121.37089, 25.06556),
            (121.37036, 25.06550),
            (121.36978, 25.06543),
            (121.36891, 25.06533),
            (121.36877, 25.06532),
            (121.36868, 25.06531),
            (121.36855, 25.06530),
            (121.36854, 25.06530),
            (121.36852, 25.06530),
            (121.36850, 25.06529),
            (121.36842, 25.06529),
            (121.36837, 25.06528),
            (121.36834, 25.06528),
            (121.36833, 25.06528),
            (121.36830, 25.06528),
            (121.36829, 25.06528),
            (121.36796, 25.06524),
            (121.36752, 25.06521),
            (121.36707, 25.06518),
            (121.36694, 25.06517),
            (121.36661, 25.06516),
            (121.36609, 25.06511),
            (121.36569, 25.06510),
            (121.36517, 25.06507),
            (121.36462, 25.06504),
            (121.36427, 25.06503),
            (121.36404, 25.06503),
            (121.36398, 25.06503),
            (121.36390, 25.06502),
            (121.36388, 25.06502),
            (121.36383, 25.06502),
            (121.36377, 25.06502),
            (121.36310, 25.06500)
            ]


def degreesToRadians(degrees):
    return degrees * pi / 180


def calcDistM(point_a, point_b):
    earthRadiusm = 6371000

    dLat = degreesToRadians(abs(point_a[1]-point_b[1]))
    dLon = degreesToRadians(abs(point_a[0]-point_b[0]))

    lat_a = degreesToRadians(point_a[1])
    lat_b = degreesToRadians(point_b[1])

    a = sin(dLat/2) * sin(dLat/2) + \
        sin(dLon/2) * sin(dLon/2) * cos(lat_a) * cos(lat_b)
    c = 2 * atan2(sqrt(a), sqrt(1-a))
    return earthRadiusm * c


vsensor = []
for (coord, last_coord) in zip(segments, segments[0:1]+segments):
    segment_dist = calcDistM(last_coord, coord)
    n = int(segment_dist/density)
    for i in range(n):
        i = i/n
        dlat = coord[0]-last_coord[0]
        dlon = coord[1]-last_coord[1]
        vsensor.append((
            last_coord[0]+i*dlat,
            last_coord[1]+i*dlon
        ))
for i in range(len(vsensor)):
    long, lat = vsensor[i]
    print(long,lat)
    res = requests.post("https://iot.cht.com.tw/iot/v1/device",json.dumps({
        "name": "反光標記"+str(i),
        "type": "general",
        "lat": lat,
        "lon": long,
    }), headers={"CK": "PK1A4T9GU1M23G57Y9"})
    print(res.headers)
    print(res.text)
